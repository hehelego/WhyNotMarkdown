## 路径计数角度下的Catalan数列

### Catalan数的定义

定义$C_n$为包含$n$个左括号,$n$个右括号的合法匹配括号序列数量.
我们考虑用一个stack,从左到右遍历括号序列,遇到左括号和右括号分别进行push和pop.
合法括号序列不会在stack为空时进行pop操作.



### 一个等价:二叉树

我们很容易找到合法匹配括号序列和二叉树的一一对应(即$C_n$为$n$个点的**不同形态**二叉树数量).
于是,我们枚举二叉树根的左右子树节点个数.有$C_0=C_1=1,C_n=\sum_{i=0}^{n-1}C_iC_{n-i-1}$
这是个卷积,用生成函数卷积构造方程可以轻松求解$C_n$.

$$
\begin{aligned}
F(x)
&=\sum_{n=0}^\infty C_n x^n\\
&=1+\sum_{n=1}^\infty x^n \sum_{i=0}^{n-1} C_i C_{n-i-1}\\
&=1+x\sum_{n=1}^\infty x^{n-1} \sum_{i=0}^{n-1} C_i C_{n-i-1}\\
&=1+x\sum_{n=0}^\infty x^n \sum_{i=0}^n C_i C_{n-i}\\
&=1+x F^2(x)\\
\implies F(x)&=\frac{1\pm \sqrt{1-4x}}{2x}
\end{aligned}
$$

$\lim_{x\to 0}F(x)=F(0)=C_0=1\implies F(x)=\frac{1-\sqrt{1-4x}}{2x}$

$$
\begin{aligned}
\sqrt{1-4x}
&={(1-4x)}^{1/2}\\
&=\sum_{n=0}^\infty \binom{\frac{1}{2}}{n}{(-4x)}^n\\
&=\sum_{n=0}^\infty {(-4)}^n x^n \prod_{i=1}^n \frac{\left(\frac{1}{2}-i+1\right)}{i}\\
&=\sum_{n=0}^\infty 2^n x^n \prod_{i=1}^n \frac{2i-3}{i}\\
&=\sum_{n=0}^\infty 2^n x^n \prod_{i=1}^n \frac{(2i-3)2i}{i\cdot 2i}\\
&=\sum_{n=0}^\infty x^n \prod_{i=1}^n \frac{(2i-3)2i}{i^2}\\
&=\sum_{n=0}^\infty x^n \frac{2\cdot 1-3}{2n-1}\prod_{i=1}^n \frac{(2i-1)2i}{i^2}\\
&=\sum_{n=0}^\infty x^n \frac{-1}{2n-1}\frac{(2n)!}{n!\, n!}\\
&=\sum_{n=0}^\infty x^n \frac{-1}{2n-1}\binom{2n}{n}
=1+\sum_{n=1}^\infty x^n \frac{-1}{2n-1}\binom{2n}{n}\\
F(x)&=\frac{1}{2x}\sum_{n=1}^\infty x^n\frac{1}{2n-1}\binom{2n}{n}\\
&=\sum_{n=0}^\infty x^n \frac{1}{2}\frac{1}{2n+1}\binom{2n+2}{n+1}\\
&=\sum_{n=0}^\infty x^n \frac{1}{2}\frac{1}{2n+1}\cdot \frac{2n+2}{n+1}\binom{2n+1}{n}\\
&=\sum_{n=0}^\infty x^n \frac{1}{2n+1}\binom{2n+1}{n}\\
&=\sum_{n=0}^\infty x^n \frac{(2n)!}{(n+1)!\, n!}\\
&=\sum_{n=0}^\infty x^n \frac{\binom{2n}{n}}{n+1}\\
&=1x^0+\sum_{n=1}^\infty x^n \left(\binom{2n}{n}-\binom{2n}{n-1}\right)
\end{aligned}
$$

### 另一角度:折线计数

我们考虑这样一个东西.
在平面直角坐标系中,我们从$(0,0)$开始走,每一步可以选择$(1,1)$或者$(1,-1)$那么不穿过$x$轴,走到$(2n,0)$的路径有多少种.
很直观,$(1,1),(1,-1)$分别和遇到左括号,遇到右括号对应,不越过$x$轴就是不在空时进行pop.

首先我们不考虑"不能穿过x轴"的约束,有$\binom{2n}{n}$种路径.
不合法的路径,一定接触了$y=-1$这条平行于x轴的直线.

考虑一条不合法的路径$L$,与$y=-1$的第一个交点为$P$那么我们将$L$中$P$右侧的的部分关于$y=-1$做对称,得到一条$(0,0)\to (2n,-2)$的路径.
而任意给一条$(0,0)\to(2n,-2)$的路径,我们可以类似地进行操作,找交点,将右侧部分翻折得到$(0,0)\to(2n,0)$的且接触了$y=-1$的路径.

于是$(0,0)\to(2n,0)$的不合法路径与$(0,0)\to(2n,-2)$的任意路径建立了一一映射,于是不合法路径有$\binom{2n}{n-1}$条(显然走$2n$次其中$n-1$次向上,$n+1$次向下).

综上所述$C_n=\binom{2n}{n}-\binom{2n}{n-1}$



### 另一个折线问题

平面直角坐标系中,$(0,0)\to(n,n)$每次选择$(1,0)$或者$(0,1)$,不允许穿过$y=x$的路径计数.
这显然和上面那个更直观的路径计数问题是等价的.
(这种折线计数问题更具有一般性,能更轻松地推广到其他问题上去,而之前那种推广时较为困难)

类似的,穿过$y=x$等价于接触$y=x+1$.对于一个不合法路径,找与$y=x+1$的首个交点,之后的部分关于$y=x+1$进行对称,与前面的部分拼接,得到$(0,0)\to(n-1,n+1)$的一个路径.而任意$(0,0)\to(n-1,n+1)$的路径,一定接触了$y=x+1$类似地,找交点,做对称,可以得到,接触了$y=x+1$的$(0,0)\to(n,n)$的路径.于是这两种东西是一样多的,都是$\binom{2n}{n-1}$


### 另一种对称方式

仍然是$(0,0)\to (n,n)$每一次$(1,0)/(0,1)$.不允许穿过$y=x$.  

这次对称与$y=x+1$的第一个交点之前的部分,于是不合法路径与$(-1,1)\to (n,n)$建立双射,这样也是算出$\binom{2n}{n-1}$




