# THUPC2021-初赛J-合法序列

## statement

对于一个长度为$n$的$0/1$序列$s$,从左到右的将每个元素标记为$s_0,s_1\dots s_n$.  
给定一个正整数$k$,从$s$中取出$T_i=s[i,i+k-1],\ i=1,2,3\dots n-k+1$.将$T_i$解读为从左到右高位到低位的一个二进制数,记它的值为$t_i$,显然有$t_i< 2^k$.  
如果对于所有$i$,我们有$s_{t_i}=1$,那么认为$s$在给定的$k$下是合法的.  

给定$n,k$保证$2^k\leq n$,求符合上面描述的条件的序列$s$的计数.  
$1\leq k\leq 4,2^k\leq n\leq 500$,输出$\mathrm{ANS}\bmod 998244353$


## solution

如果我们已知$s$的前$2^k$位,其中$s_{b_1},s_{b_2}\dots s_{b_m}=0$,那么$bin(b_1),bin(b_2)\dots bin(b_m)$不能是$s$的子串.  

这是个经典AC自动机题目.  
标记所有单词节点,和fail树上它们子树中的所有点.  
在DFA上面删掉被标记的点,则所有以根为起点,长度为$n$的路径和长度为$n$的合法串一一对应.  

估计一下这个AC自动机的规模,主要是它的trie树的大小.显然$s$前$2^k$位都是$0$的情况下trie树最大,此时trie树是一个高度为$k$的满二叉树,$|T|=O(2^k)$.这里是$0/1$串于是$|\Sigma|=2=O(1)$. 所以自动机的状态和转移都是$O(2^k)$的,我们暴力做路径计数是$O(n 2^k)$,这里$n$很小所以不用搞邻接矩阵求幂来加速.  

我们枚举前$2^k$位,把不允许的子串建个AC自动机,跑路径计数,搞出了复杂度为$O(2^{(2^k)}\times n 2^k)=O(n8^k)$简单带入数据范围估计运行时间上界,是足够通过本题的.

## code


